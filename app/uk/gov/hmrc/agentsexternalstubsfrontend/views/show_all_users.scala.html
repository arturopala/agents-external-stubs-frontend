@import play.api.Configuration
@import uk.gov.hmrc.agentsexternalstubsfrontend.models._
@import uk.gov.hmrc.play.views.html.helpers.{form, input, dropdown, inputRadioGroup}

@import uk.gov.hmrc.play.binders.ContinueUrl
@import uk.gov.hmrc.agentsexternalstubsfrontend.models.PageContext
@(users: Users, authToken: Option[String], showCurrentUserUrl: Call, context: PageContext)(implicit request: Request[_], messages: Messages, config: Configuration)

@uk.gov.hmrc.agentsexternalstubsfrontend.views.html.main_template(title = Messages("users.title"), bodyClasses = Some("full-width"), sidebarLinks = None) {

    @navigationBar(context)

    <h1 class="heading-xlarge">@Messages("users.show.header", context.planetId)</h1>

    <div style="float: right; margin-bottom: 1em;position: relative; top:-3em;right: -3em;">
        <h3 class="cya-question">
        @Messages("users.link.create")
        </h3>
        <form action="/agents-external-stubs/user/create">
            <div style="vertical-align: middle;">
                <label for="userId" style="font-size: 0.7em; color: gray;">Expected ID pattern [A-Za-z0-9-_]{3,64}</label>
                <input type="text" name="userId" pattern="[A-Za-z0-9-_]{3,64}" required>
                <button class="button">@Messages("user.show.create")</button>
            </div>
        </form>
    </div>

    <p>
    @Messages("users.show.description")
    </p>

    <table id="users" class="margin-bottom-30">
        <col style="width: 25%">
        <col style="width: 10%">
        <col style="width: 35%">
        <col style="width: 30%">
        <thead>
            <tr>
                <th scope="col">UserID</th>
                <th scope="col" style="text-align: center;">Affinity</th>
                <th scope="col" style="text-align: center;">Services</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
        @for(user <- users.users.sortBy(_.userId)){
                <tr>
                    <td>
                        <div style="overflow-wrap: break-word;">@if(user.userId==context.authorisedUserId){
                            <span style="font-weight: bold;">@user.userId</span>
                        }else{
                            @user.userId
                        }</div>
                        <div style="font-size:70%;">group: @{user.groupId.getOrElse("none")}</div>
                    </td>
                    <td style="text-align: center;">
                        <span class="badge badge-@{user.affinityGroup.map(_.toLowerCase).getOrElse("none")}">@user.affinityGroup.getOrElse("none")</span>
                    </td>
                    <td style="text-align: center; font-size: 0.9em;">
                      @for(enrolments <- user.principalEnrolments) {
                        @if(enrolments.nonEmpty) {
                            <span style="display: inline-block;
                                margin: 0.1em 0;">@{enrolments.head.key}</span> <span>@{enrolments.head.identifiersValues.mkString("(","/",")")}</span>
                            @for(e <- enrolments.tail) {
                                , <span style="display: inline-block;
                                margin: 0.1em 0;">@e.key</span> <span>@{e.identifiersValues.mkString("(","/",")")}</span>
                            }
                        }
                      }
                    </td>
                    <td>@if(user.userId==context.authorisedUserId){
                        <div>
                            <a href="/agents-external-stubs/user?userId=@user.userId">View</a> |
                            <a href="/agents-external-stubs/user/edit?userId=@user.userId">Edit</a> |
                            <span style="color: black; font-weight: bold;">Current user </span>
                        </div>
                    }else{
                        <div>
                            <a href="/agents-external-stubs/user?userId=@user.userId">View</a> |
                            <a href="/agents-external-stubs/user/edit?userId=@user.userId">Edit</a> |
                            <a href="/agents-external-stubs/user/remove?userId=@user.userId">Remove</a> |
                            <a href="/agents-external-stubs/sign-in?userId=@user.userId&continue=/agents-external-stubs/users">Sign-in</a>
                        </div>
                    }</td>
                </tr>
        }
        </tbody>
    </table>

}
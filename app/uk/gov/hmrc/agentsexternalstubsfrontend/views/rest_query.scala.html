@import play.api.Configuration
@import uk.gov.hmrc.agentsexternalstubsfrontend.models._
@import uk.gov.hmrc.play.views.html.helpers.{form, input, dropdown, inputRadioGroup, errorSummary, dateFieldsFreeInlineLegend, singleCheckbox}

@import play.api.libs.json.JsObject
@import uk.gov.hmrc.play.views.html.helpers.{form, input, dropdown, inputRadioGroup, errorSummary, dateFieldsFreeInlineLegend, singleCheckbox, textArea}

@import uk.gov.hmrc.agentsexternalstubsfrontend.controllers.RestQueryController.RestQuery
@import play.api.libs.ws.WSResponse
@import play.mvc.Http.HeaderNames
@import play.api.libs.json.Json
@import uk.gov.hmrc.agentsexternalstubsfrontend.models.PageContext
@(restQueryForm: Form[RestQuery], postUrl: Call, cancelUrl: Call, resetUrl: Call, response: Option[WSResponse], curlCommand: Option[String], context: PageContext)(implicit request: Request[_], messages: Messages, config: Configuration)

@uk.gov.hmrc.agentsexternalstubsfrontend.views.html.main_template(title = Messages("rest.query.title"), bodyClasses = Some("full-width")) {

    @navigationBar(context)

    @if(response.isDefined){
    @for(r <- response){
        <h1 class="heading-xlarge">
            @r.status @r.statusText
        </h1>

        <div class="form-hint" style="color:black;">
            @{restQueryForm.data("method")} @{restQueryForm.data("url")}
        </div>

        @for(curl <- curlCommand){
            <div style="font-family: monospace; font-size: 0.8em; color: white; padding:0.5em; margin-bottom: 1em; background: lightgray;">
            @curl
            </div>
        }

        <div style="margin-bottom: 2em;">
            <div style="font-family: monospace; font-size: 0.8em; color: gray">
            @for((k,vv) <- r.allHeaders){
                <div>@k: @vv</div>
            }
            </div>

            @if(r.header(HeaderNames.CONTENT_TYPE).contains("application/json")){
                <div style="font-family: monospace; font-size: 0.8em;margin-top:1em;white-space: pre-wrap; overflow: scroll; max-height: 40em; padding: 1em; border-style: dotted">@{Json.prettyPrint(r.json)}</div>
            }
        </div>
    }} else {
        <h1 class="heading-xlarge" style="margin-bottom: 0.5em;">@Messages("rest.query.header", (if(Set('a','e','o','u','y').contains(context.authorisedUserId.head.toLower)) "an " else "a ")+context.authorisedUserId)</h1>

        <p class="form-hint">
        @Messages("rest.query.description", context.authorisedUserId)
        </p>
    }

    <div>
        @form(action = postUrl, 'id -> "restQueryForm", 'novalidate -> "novalidate") {
            <fieldset>

                @if(response.isDefined) {
                    <div class="form-group" style="vertical-align: middle;">

                        <button class="button" type="submit" id="update">
                        @Messages("rest.query.submit")
                        </button>

                        <a style="display: inline-block;
                            margin-top: 0.5em;" href="@{resetUrl.url}">@Messages("rest.query.reset")</a> |
                        <a style="display: inline-block;
                            margin-top: 0.5em;" href="@{cancelUrl.url}">@Messages("rest.query.cancel")</a>

                    </div>
                }

                <div class="form-group soft--ends">
                @dropdown(
                    restQueryForm("method"),
                    Seq("GET"->"GET", "POST"->"POST", "PUT"->"PUT", "DELETE"->"DELETE"),
                    false,
                    '_label -> Html("""<span class="h2-heading">"""+ Messages("rest.query.form.method") + """</span>"""),
                    '_selectClass -> Html("""input--medium input--cleared""")
                )
                </div>

                <div class="form-group">
                @input(
                    restQueryForm("url"),
                    '_label -> Messages("rest.query.form.url"),
                    '_inputClass -> "input--cleared input--fullwidth-important",
                    '_labelTextClass -> "h2-heading",
                    '_labelClass -> "soft--ends"
                )
                </div>

                <div class="form-group" style="vertical-align: middle;">

                    <button class="button" type="submit" id="update">
                    @Messages("rest.query.submit")
                    </button>

                    <a style="display: inline-block;
                        margin-top: 0.5em;" href="@{resetUrl.url}">@Messages("rest.query.reset")</a> |
                    <a style="display: inline-block; margin-top:0.5em;" href="@{cancelUrl.url}">@Messages("rest.query.cancel")</a>

                </div>

                <div class="form-field-group">
                @textArea(
                    restQueryForm("payload"),
                    '_label -> Html("""<span class="h2-heading">"""+ Messages("rest.query.form.payload") + """</span>"""),
                    '_inputClass -> "textarea-large"
                )
                </div>

                <div class="form-group" style="vertical-align: middle;">

                    <button class="button" type="submit" id="update">
                        @Messages("rest.query.submit")
                    </button>

                    <a style="display: inline-block;
                        margin-top: 0.5em;" href="@{resetUrl.url}">@Messages("rest.query.reset")</a> |
                    <a style="display: inline-block; margin-top:0.5em;" href="@{cancelUrl.url}">@Messages("rest.query.cancel")</a>

                </div>
            </fieldset>
        }
    </div>

}